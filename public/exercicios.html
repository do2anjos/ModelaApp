<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self';" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atividades | Modela+</title>
    <script>
        (function() {
            try {
                var theme = localStorage.getItem('theme') || 'system';
                if (['dark','light'].includes(theme)) {
                    document.documentElement.setAttribute('data-theme', theme);
                } else if(window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                }
            } catch(e){}
        })();
    </script>

    <script>
        (function() {
            try {
                var daltonism = localStorage.getItem('daltonism') || 'nenhum';
                if (daltonism && daltonism !== 'nenhum') {
                    document.documentElement.setAttribute('data-daltonismo', daltonism);
                }
            } catch(e){}
        })();
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/style.css">
    <style>
        /* Filtros de daltonismo aplicados imediatamente (alinhados com style.css) */
        html[data-daltonismo="protanopia"] {
            filter: contrast(1.3) saturate(0.8) brightness(1.1) sepia(0.2);
        }
        html[data-daltonismo="deuteranopia"] {
            filter: contrast(1.25) saturate(1.1) brightness(0.95) hue-rotate(-15deg);
        }
        html[data-daltonismo="tritanopia"] {
            filter: contrast(1.2) saturate(0.9) brightness(1.05) hue-rotate(30deg);
        }

        /* PROTE√á√ÉO GLOBAL DA LOGO */
        /* Garante que a logo n√£o seja afetada por filtros de acessibilidade (daltonismo) ou tema */
        .logo img,
        html[data-daltonismo] .logo img,
        [data-theme="dark"] .logo img,
        .lesson-header .logo img,
        #main-logo {
            filter: none !important;
            -webkit-filter: none !important; /* Compatibilidade com Safari */
            transform: none !important;
            opacity: 1 !important;
            visibility: visible !important;
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
        }

        /* Prevenir qualquer manipula√ß√£o visual da logo */
        .logo img::before,
        .logo img::after,
        .lesson-header .logo img::before,
        .lesson-header .logo img::after {
            display: none !important;
            content: none !important;
        }

        /* Garantir que a logo seja sempre vis√≠vel e correta */
        .logo img {
            pointer-events: auto !important;
            user-select: none !important;
        }

        /* Margem do √≠cone de cadeado nas atividades bloqueadas */
        .exercise-card .locked-icon {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            min-width: 140px !important; /* Mesmo tamanho do bot√£o */
            grid-column: 3 !important; /* For√ßa posi√ß√£o na 3¬™ coluna */
        }
        
        .exercise-card .locked-icon svg {
            flex-shrink: 0 !important;
        }

        /* Padroniza√ß√£o dos status - sem cor de fundo */
        .exercise-status.completed,
        .exercise-status.in-progress,
        .exercise-status.todo {
            background-color: transparent !important;
            color: var(--foreground) !important;
        }
        
        /* Corre√ß√£o para dark mode - texto branco */
        [data-theme="dark"] .exercise-status.completed,
        [data-theme="dark"] .exercise-status.in-progress,
        [data-theme="dark"] .exercise-status.todo {
            background-color: transparent !important;
            color: white !important;
        }

        /* Suavizar negrito no dark mode */
        [data-theme="dark"] strong,
        [data-theme="dark"] .font-semibold,
        [data-theme="dark"] .font-bold,
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6,
        [data-theme="dark"] .criterion-name {
            font-weight: 500 !important;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.33.0/src-min-noconflict/ace.js"></script>
</head>
<body class="dashboard-body exercicios-page">
    <a href="#main-content" class="skip-link">Pular para o conte√∫do principal</a>

    <div class="dashboard-wrapper">
        <aside class="dashboard-sidebar">
            <div class="sidebar-logo"><a href="/home.html"><img src="/images/Modela+a.png" alt="Logo da Modela+"></a></div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="/home.html">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                        Painel
                    </a></li>
            <li><a href="/conteudos.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
                M√≥dulos
            </a></li>
            <li><a href="/aulas.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                Aulas
            </a></li>
            <li><a href="/exercicios.html" class="active">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                Atividades
            </a></li>
            <li><a href="/forum.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v5Z"/><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"/></svg>
                F√≥rum
            </a></li>
            <li><a href="/ranking.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                Ranking
            </a></li>
            <li><a href="/certificado.html">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 17c-.8.8-2 .8-2.8 0l-2-2a2 2 0 1 1 2.8-2.8l.2.2.2-.2a2 2 0 1 1 2.8 2.8Z"/></svg>
                Certificados
            </a></li>
                </ul>
            </nav>
        </aside>

        <div class="dashboard-main">
            <header id="exercise-list-header" class="dashboard-header">
                <div class="header-main-content">
                    <nav class="breadcrumb" aria-label="Navega√ß√£o estrutural">
                        <ol>
                            <li><a href="/home.html">In√≠cio</a></li>
                            <li><a href="/home.html">Painel</a></li>
                            <li aria-current="page">Atividades</li>
                        </ol>
                    </nav>
                    <h1>Atividades</h1>
                    <div class="tabs-nav">
                        <button class="tab-link active" data-tab="uml">1. Modelagem com UML</button>
                        <button class="tab-link" data-tab="requisitos">2. Engenharia de Requisitos <svg class="lock-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></button>
                        <button class="tab-link" data-tab="arquitetura">3. Arquitetura de Sistemas <svg class="lock-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></button>
                        <button class="tab-link" data-tab="padroes">4. Padr√µes de Projeto <svg class="lock-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></button>
                    </div>
                </div>
                <div class="user-profile-menu">
                    <button class="user-avatar-button" id="user-menu-button" aria-label="Abrir menu do usu√°rio">
                        MD
                    </button>
                    <div class="dropdown-menu hidden" id="user-dropdown">
                        <div class="dropdown-header">
                            <p class="user-name">Matheus dos Anjos</p>
                            <p class="user-email">mdap.lic20@uea.edu.br</p>
                        </div>
                        <ul>
                            <li><a href="/perfil.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Meu Perfil</a></li>
                            <li><a href="/configuracoes.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-4.44a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.88z"/><path d="M18 2h-2.17a2 2 0 0 0-1.41.59L12 5l-2.41-2.41A2 2 0 0 0 8.17 2H6"/><path d="M9.5 2a2.83 2.83 0 0 1 5 0"/></svg> Configura√ß√µes</a></li>
                            <li><a href="/login.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg> Sair</a></li>
                        </ul>
                    </div>
                </div>
            </header>
            
            <header id="activity-detail-header" class="dashboard-header hidden">
                <div class="header-main-content">
                    <h1 id="activity-title-header">T√≠tulo da Atividade</h1>
                    <a href="#" id="back-to-exercises-btn" class="back-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m15 18-6-6 6-6"/>
                        </svg>
                        Voltar
                    </a>
                </div>
                <div class="header-actions">
                    <div class="user-profile-menu">
                        <button class="user-avatar-button" id="user-menu-button-detail" aria-label="Abrir menu do usu√°rio">
                            MD
                        </button>
                        <div class="dropdown-menu hidden" id="user-dropdown-detail">
                           <div class="dropdown-header">
                                <p class="user-name">Matheus dos Anjos</p>
                                <p class="user-email">mdap.lic20@uea.edu.br</p>
                            </div>
                            <ul>
                            <li><a href="/perfil.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Meu Perfil</a></li>
                            <li><a href="/configuracoes.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-4.44a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8.88z"/><path d="M18 2h-2.17a2 2 0 0 0-1.41.59L12 5l-2.41-2.41A2 2 0 0 0 8.17 2H6"/><path d="M9.5 2a2.83 2.83 0 0 1 5 0"/></svg> Configura√ß√µes</a></li>
                            <li><a href="/login.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg> Sair</a></li>
                        </ul>
                        </div>
                    </div>
                </div>
            </header>

            <main class="dashboard-content" id="main-content">
                <div id="exercise-list-view">
                    <div class="tabs-content">
                        <div class="tab-pane active" id="uml">
                            <div class="exercise-card">
                                <span class="exercise-status in-progress">Em Andamento</span>
                                <div class="exercise-info">
                                    <h3>Atividade 1: Diagrama de Classes</h3>
                                    <p>Crie o diagrama de classes para um sistema de biblioteca.</p>
                                </div>
                                <button class="button button-primary view-activity-btn" data-activity-id="uml-ex1">Continuar</button>
                            </div>
                            <div class="exercise-card">
                                <span class="exercise-status in-progress">Bloqueado</span>
                                <div class="exercise-info">
                                    <h3>Atividade 2: Diagrama de Sequ√™ncia</h3>
                                    <p>Modele o fluxo de login de um usu√°rio.</p>
                                </div>
                                <div class="locked-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                </div>
                            </div>
                            <div class="exercise-card">
                                <span class="exercise-status todo">Bloqueado</span>
                                <div class="exercise-info">
                                    <h3>Atividade 3: Diagrama de Casos de Uso</h3>
                                    <p>Elabore um diagrama de casos de uso para um sistema de caixa eletr√¥nico (ATM).</p>
                                </div>
                                <div class="locked-icon" aria-hidden="true">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                                </div>
                            </div>
                        </div>
                         <div class="tab-pane" id="requisitos">
                            </div>
                    </div>
                </div>

                <div id="activity-detail-view" class="hidden">
                    <div class="activity-wrapper">
                        <div id="activity-instructions" class="activity-instructions">
                            </div>
                        <div class="activity-submission">
                            </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

<!-- Scripts para gerenciar dark mode, daltonism mode e usabilidade -->
<script src="/js/auth.js"></script>
<script src="/js/dark-mode.js"></script>
<script src="/js/daltonism-mode.js"></script>
<script src="/js/usability.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- TEMPLATES HTML PARA A √ÅREA DE SUBMISS√ÉO ---
    const submissionCompletedHTML = `
        <div class="dashboard-card">
            <div class="submission-header">
                <h3>Enviar Resposta</h3>
                <div class="submission-toggles">
                    <button class="submission-toggle-btn active" data-submission="editor">Editor</button>
                    <button class="submission-toggle-btn" data-submission="upload">Upload de Arquivo</button>
                </div>
            </div>
            <div id="editor-method" class="submission-method">
                <div style="display: flex; justify-content: center; align-items: center; min-height: 200px;">
                    <button class="button button-primary" id="open-editor-btn">Abrir Editor</button>
                </div>
            </div>
            <div id="upload-method" class="submission-method hidden">
                <div class="file-upload-area">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg>
                    <p>Arraste e solte o arquivo aqui ou <strong>clique para selecionar</strong>.</p>
                    <input type="file" class="file-input" hidden>
                </div>
            </div>
            <div class="submission-footer" style="display: none;">
                <button type="submit" class="button button-primary full-width">Enviar Atividade</button>
            </div>
        </div>
    `;

    const submissionPendingHTML = `
        <div class="dashboard-card">
            <div class="submission-header">
                <h3>Enviar Resposta</h3>
                <div class="submission-toggles">
                    <button class="submission-toggle-btn active" data-submission="editor">Editor</button>
                    <button class="submission-toggle-btn" data-submission="upload">Upload de Arquivo</button>
                </div>
            </div>
            <div id="editor-method" class="submission-method">
                <div id="code-editor"></div>
            </div>
            <div id="upload-method" class="submission-method hidden">
                <div class="file-upload-area">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                    <p>Arraste e solte o arquivo aqui ou <strong>clique para selecionar</strong>.</p>
                    <input type="file" class="file-input" hidden>
                </div>
            </div>
            <div class="submission-footer" style="display: none;">
                <button type="submit" class="button button-primary full-width">Enviar Atividade</button>
            </div>
        </div>
    `;

    // --- BANCO DE DADOS DE EXEMPLO DAS ATIVIDADES ---
    const activityDatabase = {
        "uml-ex1": {
            title: "Atividade 1: Diagrama de Classes",
            instructions: `
                <div class="dashboard-card activity-instructions-card">
                    <h2>Instru√ß√µes da Atividade</h2>
                    <p style="font-size: 1.05em; line-height: 1.7; margin-bottom: 1.25rem;"><strong>Desafio:</strong> Crie um diagrama de classes UML completo para modelar um sistema de gerenciamento de biblioteca.</p>
                    
                    <h3 style="margin-top: 1.5rem; margin-bottom: .75rem; color: var(--primary);">üìñ Contexto</h3>
                    <p style="line-height: 1.7; margin-bottom: 1.25rem;">O sistema deve gerenciar livros, usu√°rios, empr√©stimos e devolu√ß√µes. A biblioteca possui um acervo variado e precisa controlar quem pegou cada livro, quando e se j√° devolveu.</p>
                    
                    <h3 style="margin-top: 1.5rem; margin-bottom: .75rem; color: var(--primary);">üéØ Objetivos de Aprendizagem</h3>
                    <ul style="line-height: 1.7; margin-bottom: 1.25rem; padding-left: 1.5rem;">
                        <li><strong>Identificar classes principais</strong> do dom√≠nio do problema</li>
                        <li><strong>Definir atributos</strong> relevantes para cada classe</li>
                        <li><strong>Especificar m√©todos</strong> que representam o comportamento das classes</li>
                        <li><strong>Estabelecer relacionamentos</strong> entre as classes (associa√ß√£o, agrega√ß√£o, composi√ß√£o, heran√ßa)</li>
                        <li><strong>Aplicar multiplicidade</strong> corretamente nos relacionamentos</li>
                    </ul>
                    
                    <h3 style="margin-top: 1.5rem; margin-bottom: .75rem; color: var(--primary);">üìã Requisitos Funcionais</h3>
                    <ol style="line-height: 1.7; margin-bottom: 1.25rem; padding-left: 1.5rem;">
                        <li>O sistema deve gerenciar informa√ß√µes de <strong>livros</strong> (t√≠tulo, autor, ISBN, editora, ano, categoria)</li>
                        <li>Deve cadastrar <strong>usu√°rios</strong> (nome, CPF, email, telefone, endere√ßo)</li>
                        <li>Deve registrar <strong>empr√©stimos</strong> (data empr√©stimo, data prevista devolu√ß√£o, data real devolu√ß√£o)</li>
                        <li>Cada livro pode ter m√∫ltiplos <strong>exemplares f√≠sicos</strong></li>
                        <li>Usu√°rios podem fazer <strong>reservas</strong> de livros</li>
                        <li>O sistema deve calcular <strong>multas</strong> por atraso</li>
                        <li>Funcion√°rios podem gerenciar todo o acervo</li>
                    </ol>
                    
                    <div style="margin: 1.5rem 0; text-align: center;">
                        <img src="/images/modelo 1.png" alt="Modelo de Diagrama de Classes" style="max-width: 100%; height: auto; border-radius: var(--radius); box-shadow: var(--shadow-soft); border: 1px solid var(--border);" />
                        <p style="margin-top: 1rem; font-size: 0.95em;">
                            <a href="https://docs.google.com/document/d/1dAn3jqXbqtZUG5ESqDuLgxDuYXlvBMzfJ4j59WXUKL4/edit?usp=sharing" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none; font-weight: 600;">
                                üìö Acesse para ver mais modelos
                            </a>
                        </p>
                    </div>
                    
                    <h3 style="margin-top: 1.5rem; margin-bottom: .75rem; color: var(--primary);">üí° Dicas</h3>
                    <div style="background: var(--muted); border-left: 4px solid var(--primary); padding: 1rem 1.25rem; border-radius: 0.5rem; margin-bottom: 1.25rem;">
                        <ul style="line-height: 1.7; margin: 0; padding-left: 1.5rem;">
                            <li>Pense em classes como <strong>Livro</strong>, <strong>Exemplar</strong>, <strong>Usuario</strong>, <strong>Emprestimo</strong>, <strong>Reserva</strong>, <strong>Funcionario</strong></li>
                            <li>Use <strong>heran√ßa</strong> quando houver generaliza√ß√£o (ex: Usuario como classe pai de Cliente e Funcionario)</li>
                            <li>Identifique <strong>associa√ß√µes</strong>: um empr√©stimo associa um exemplar a um usu√°rio</li>
                            <li>Defina <strong>multiplicidades</strong>: um usu√°rio pode ter v√°rios empr√©stimos, mas cada empr√©stimo pertence a um √∫nico usu√°rio</li>
                            <li>Adicione m√©todos como <strong>emprestar()</strong>, <strong>devolver()</strong>, <strong>calcularMulta()</strong>, <strong>renovar()</strong></li>
                        </ul>
                    </div>
                    
                    <h3 style="margin-top: 1.5rem; margin-bottom: .75rem; color: var(--primary);">üöÄ Como Come√ßar</h3>
                    <ol style="line-height: 1.7; margin-bottom: 1.25rem; padding-left: 1.5rem;">
                        <li>Clique em <strong>"Abrir Editor"</strong> abaixo</li>
                        <li>Selecione <strong>"Diagrama de Classes"</strong> no dropdown</li>
                        <li>Comece modelando as classes principais</li>
                        <li>Adicione atributos e m√©todos a cada classe</li>
                        <li>Estabele√ßa os relacionamentos entre as classes</li>
                        <li>Exporte o diagrama em PNG e fa√ßa o upload</li>
                    </ol>
                </div>
                <div class="dashboard-card activity-scoring-card">
                    <h2>Sistema de Pontua√ß√£o por Crit√©rio</h2>
                    <div class="scoring-system">
                        <div class="scoring-criteria">
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Identifica√ß√£o de Classes</span>
                                    <span class="criterion-score">2.5 pontos</span>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Atributos e M√©todos</span>
                                    <span class="criterion-score">2.5 pontos</span>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Relacionamentos</span>
                                    <span class="criterion-score">2.5 pontos</span>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Nota√ß√£o UML</span>
                                    <span class="criterion-score">2.5 pontos</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            submissionContent: submissionCompletedHTML
        },
        "uml-ex2": {
            title: "Atividade 2: Diagrama de Sequ√™ncia",
            instructions: `
                <div class="dashboard-card activity-instructions-card">
                    <h2>Instru√ß√µes da Atividade</h2>
                    <p><strong>Atividade:</strong> Modele o fluxo de login de um usu√°rio.</p>
                    <h3>Objetivos</h3>
                    <ul>
                        <li>Identificar atores e objetos.</li>
                        <li>Mapear a troca de mensagens.</li>
                    </ul>
                </div>
                <div class="dashboard-card activity-scoring-card">
                    <h2>Sistema de Pontua√ß√£o por Crit√©rio</h2>
                    <div class="scoring-system">
                        <div class="scoring-criteria">
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Identifica√ß√£o de Atores/Objetos</span>
                                    <span class="criterion-score">0/2.5 pontos</span>
                                </div>
                                <div class="criterion-description">
                                    <p>Identificar corretamente os atores e objetos envolvidos no fluxo de login.</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Sequ√™ncia de Mensagens</span>
                                    <span class="criterion-score">0/2.5 pontos</span>
                                </div>
                                <div class="criterion-description">
                                    <p>Mapear corretamente a sequ√™ncia de mensagens entre os objetos.</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Condi√ß√µes e Loops</span>
                                    <span class="criterion-score">0/2.5 pontos</span>
                                </div>
                                <div class="criterion-description">
                                    <p>Incluir condi√ß√µes e loops quando necess√°rio (ex: tentativas de login).</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Nota√ß√£o UML</span>
                                    <span class="criterion-score">0/2.5 pontos</span>
                                </div>
                                <div class="criterion-description">
                                    <p>Utilizar corretamente a nota√ß√£o UML para diagramas de sequ√™ncia.</p>
                                </div>
                            </div>
                        </div>
                        <div class="scoring-summary">
                            <div class="total-score">
                                <span>Pontua√ß√£o Total: </span>
                                <span class="score-value">0/10 pontos</span>
                            </div>
                            <div class="score-feedback">
                                <p><strong>Feedback:</strong> Submeta sua resposta para receber avalia√ß√£o detalhada.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            submissionContent: submissionPendingHTML
        },
        "uml-ex3": {
            title: "Atividade 3: Diagrama de Casos de Uso",
            instructions: `
                <div class="dashboard-card activity-instructions-card">
                    <h2>Instru√ß√µes da Atividade</h2>
                    <p><strong>Atividade:</strong> Elabore um diagrama de casos de uso para um caixa eletr√¥nico (ATM).</p>
                    <h3>Objetivos</h3>
                    <ul>
                        <li>Identificar atores (Cliente, Banco).</li>
                        <li>Definir os casos de uso.</li>
                    </ul>
                </div>
                <div class="dashboard-card activity-scoring-card">
                    <h2>Sistema de Pontua√ß√£o por Crit√©rio</h2>
                    <div class="scoring-system">
                        <div class="scoring-criteria">
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Identifica√ß√£o de Atores</span>
                                    <span class="criterion-score">0/2.5 pontos</span>
                                </div>
                                <div class="criterion-description">
                                    <p>Identificar corretamente todos os atores envolvidos no sistema.</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Casos de Uso Principais</span>
                                    <span class="criterion-score">0/2.5 pontos</span>
                                </div>
                                <div class="criterion-description">
                                    <p>Definir os casos de uso principais do sistema (saque, consulta, etc.).</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Relacionamentos</span>
                                    <span class="criterion-score">0/2.5 pontos</span>
                                </div>
                                <div class="criterion-description">
                                    <p>Estabelecer corretamente os relacionamentos entre atores e casos de uso.</p>
                                </div>
                            </div>
                            <div class="criterion">
                                <div class="criterion-header">
                                    <span class="criterion-name">Inclus√£o/Extens√£o</span>
                                    <span class="criterion-score">0/2.5 pontos</span>
                                </div>
                                <div class="criterion-description">
                                    <p>Utilizar corretamente rela√ß√µes de inclus√£o e extens√£o quando aplic√°vel.</p>
                                </div>
                            </div>
                        </div>
                        <div class="scoring-summary">
                            <div class="total-score">
                                <span>Pontua√ß√£o Total: </span>
                                <span class="score-value">0/10 pontos</span>
                            </div>
                            <div class="score-feedback">
                                <p><strong>Feedback:</strong> Submeta sua resposta para receber avalia√ß√£o detalhada.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            submissionContent: submissionPendingHTML
        }
    };

    // --- ELEMENTOS DO DOM ---
    const exerciseListView = document.getElementById('exercise-list-view');
    const activityDetailView = document.getElementById('activity-detail-view');
    const listHeader = document.getElementById('exercise-list-header');
    const detailHeader = document.getElementById('activity-detail-header');
    const viewActivityBtns = document.querySelectorAll('.view-activity-btn');
    const backToExercisesBtn = document.getElementById('back-to-exercises-btn');
    const activityTitleHeader = document.getElementById('activity-title-header');
    const instructionsWrapper = document.getElementById('activity-instructions');
    const submissionWrapper = document.querySelector('.activity-submission');

    // --- FUN√á√ïES DE INICIALIZA√á√ÉO ---
    function initializeSubmissionPanel() {
        const submissionToggles = submissionWrapper.querySelectorAll('.submission-toggle-btn');
        const editorMethod = submissionWrapper.querySelector('#editor-method');
        const uploadMethod = submissionWrapper.querySelector('#upload-method');
        const openEditorBtn = submissionWrapper.querySelector('#open-editor-btn');
        
        if (submissionToggles.length > 0) {
            submissionToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    submissionToggles.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const method = this.getAttribute('data-submission');
                    const submitFooter = submissionWrapper.querySelector('.submission-footer');
                    if (method === 'editor') {
                        editorMethod.classList.remove('hidden');
                        uploadMethod.classList.add('hidden');
                        if (submitFooter) submitFooter.style.display = 'none';
                    } else {
                        uploadMethod.classList.remove('hidden');
                        editorMethod.classList.add('hidden');
                        if (submitFooter) submitFooter.style.display = 'block';
                    }
                });
            });
        }
        
        // Event listener para o bot√£o "Abrir Editor" (abre overlay de editor UML)
        if (openEditorBtn) {
            openEditorBtn.addEventListener('click', function() {
                // Mostrar o bot√£o "Enviar Atividade" no painel principal
                const submitFooter = submissionWrapper.querySelector('.submission-footer');
                if (submitFooter) submitFooter.style.display = 'block';

                // Criar overlay de tela inteira
                const overlay = document.createElement('section');
                overlay.id = 'uml-editor-overlay';
                overlay.setAttribute('role', 'region');
                overlay.setAttribute('aria-label', 'Editor UML');
                overlay.setAttribute('style', 'position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--background); z-index: 9999; overflow: auto; padding: 2rem;');

                overlay.innerHTML = `
                    <div style=\"max-width: 1200px; margin: 0 auto;\">
                        <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: .75rem;\">
                            <h3 style=\"margin: 0;\">Crie seu Diagrama</h3>
                            <button id=\"close-uml-editor-overlay\" class=\"button\" style=\"background: var(--primary); color: var(--primary-foreground);\">Fechar</button>
                        </div>
                        <div style=\"display:flex; align-items:center; gap:.5rem; justify-content:flex-end; margin-top: .25rem; margin-bottom: 1rem;\">
                            <button id=\"step-prev\" class=\"button\" aria-label=\"Anterior\" disabled><</button>
                            <span id=\"step-indicator\">1/2</span>
                            <button id=\"step-next\" class=\"button\" aria-label=\"Pr√≥ximo\">></button>
                        </div>

                        <!-- Passo 1: Ajuda e sele√ß√£o -->
                        <div id=\"uml-step-1\">
                            <div class="editor-help" style="background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 2rem 2.2rem 1.7rem 2.2rem; box-shadow: var(--shadow-soft); margin-bottom: 1.35rem;">
                                <details open>
                                    <summary style="font-size:1.04em">Tutorial Pr√°tico</summary>
                                    <div style="padding-top: .7em;">
                                        <h4 style="margin: .75rem 0 .5rem 0; font-size:1.08em;">Passo a Passo</h4>
                                        <ol style="line-height:1.75; margin: 0 0 1.25rem 1.3rem; padding: 0;">
                                            <li style="margin-bottom:.33em;">Escolha o <strong>tipo de diagrama</strong> no dropdown abaixo (Classes, Casos de Uso...)</li>
                                            <li style="margin-bottom:.33em;">O editor abrir√° no <strong>Passo 2</strong> com um modelo inicial</li>
                                            <li style="margin-bottom:.33em;">Clique duas vezes em um elemento para <strong>editar o texto</strong></li>
                                            <li style="margin-bottom:.33em;">Arraste formas da lateral para adicionar elementos</li>
                                            <li style="margin-bottom:.33em;">Use <kbd>Del</kbd> para apagar itens</li>
                                            <li style="margin-bottom:.33em;">Conecte usando as setas azuis das bordas dos blocos</li>
                                        </ol>
                                        <h4 style="margin: .75rem 0 .5rem 0; font-size:1.08em;">Atalhos Essenciais</h4>
                                        <ul style="line-height:1.7; margin: 0 0 1.1rem 1.3rem; padding: 0;">
                                            <li style="margin-bottom:.33em;"><kbd>Ctrl</kbd> + <kbd>Z</kbd> / <kbd>Y</kbd>: Desfazer / Refazer</li>
                                            <li style="margin-bottom:.33em;"><kbd>Ctrl</kbd> + <kbd>C</kbd> / <kbd>V</kbd> / <kbd>D</kbd>: Copiar / Colar / Duplicar</li>
                                            <li style="margin-bottom:.33em;"><kbd>Shift</kbd> + Arrastar: Sele√ß√£o m√∫ltipla</li>
                                            <li style="margin-bottom:.33em;"><kbd>Ctrl</kbd> + Roda do mouse: Zoom</li>
                                        </ul>
                                        <h4 style="margin: .75rem 0 .5rem 0; font-size:1.08em;">Exportar seu Diagrama</h4>
                                        <ol style="line-height:1.7; margin: 0 0 0.5rem 1.3rem; padding: 0;">
                                            <li style="margin-bottom:.33em;">Menu <strong>File ‚Üí Export as</strong></li>
                                            <li style="margin-bottom:.33em;">Selecione PNG para enviar (ou SVG para alt√≠ssima qualidade)</li>
                                            <li style="margin-bottom:.33em;">Ajuste <em>scale</em> para 2x ou 3x para imagem n√≠tida</li>
                                            <li style="margin-bottom:.33em;">Clique em <strong>Export</strong> e salve o arquivo</li>
                                        </ol>
                                        <div style="margin-top:.9rem;padding:.5em 1em; background:var(--muted,#eef2fd);border-radius:.45em;font-size:.93em;color:var(--muted-foreground,#42528b);max-width:95%;">
                                            üí° <b>Dica:</b> Ap√≥s exportar, retorne ao Passo 1 e use a aba <b>Upload de Arquivo</b> para enviar seu diagrama!
                                        </div>
                                    </div>
                                </details>
                            </div>
                            
                        </div>

                        <!-- Passo 2: Editor -->
                        <div id=\"uml-step-2\" class=\"hidden\">
                            <div class=\"editor-controls\" style=\"display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;\">
                                <label class=\"select-group\" for=\"uml-diagram-type\" style=\"display:flex;align-items:center;gap:.5rem;\">
                                    <span>Tipo:</span>
                                    <select id=\"uml-diagram-type\" aria-label=\"Tipo de diagrama UML\">
                                        <option value=\"\">Selecione um tipo...</option>
                                        <option value=\"classes\">Diagrama de Classes</option>
                                        <option value=\"casos-uso\">Diagrama de Casos de Uso</option>
                                        <option value=\"sequencia\">Diagrama de Sequ√™ncia</option>
                                        <option value=\"atividades\">Diagrama de Atividades</option>
                                        <option value=\"estados\">Diagrama de Estados</option>
                                        <option value=\"componentes\">Diagrama de Componentes</option>
                                    </select>
                                </label>
                                <span id=\"editor-status\" class=\"status-indicator\">Editor pronto</span>
                            </div>
                            <div class=\"uml-editor-container\" style=\"background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 0; box-shadow: var(--shadow-soft);\">
                                <iframe id=\"uml-editor-iframe\" src=\"https://embed.diagrams.net/?embed=1&ui=kennedy&lang=pt-BR&noSaveBtn=1&noExitBtn=1&proto=json&libs=uml;general&grid=1&nav=1&shadow=0&splash=0\" width=\"100%\" height=\"600\" style=\"display:block; border: 0; border-radius: var(--radius);\"></iframe>
                            </div>
                            <div id=\"saved-work-preview\" class=\"saved-work-preview hidden\" style=\"margin-top: 1rem;\">
                                <h4>Seu trabalho salvo:</h4>
                                <img id=\"diagram-thumbnail\" alt=\"Pr√©-visualiza√ß√£o do diagrama\" />
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(overlay);

                // Navega√ß√£o por passos
                const step1 = overlay.querySelector('#uml-step-1');
                const step2 = overlay.querySelector('#uml-step-2');
                const stepPrev = overlay.querySelector('#step-prev');
                const stepNext = overlay.querySelector('#step-next');
                const stepIndicator = overlay.querySelector('#step-indicator');
                let currentStep = 1;

                function updateSteps() {
                    if (currentStep === 1) {
                        step1.classList.remove('hidden');
                        step2.classList.add('hidden');
                        stepPrev.setAttribute('disabled', '');
                        stepIndicator.textContent = '1/2';
                    } else {
                        step1.classList.add('hidden');
                        step2.classList.remove('hidden');
                        stepPrev.removeAttribute('disabled');
                        stepIndicator.textContent = '2/2';
                    }
                }

                if (stepPrev) {
                    stepPrev.addEventListener('click', function() {
                        if (currentStep > 1) {
                            currentStep = 1;
                            updateSteps();
                        }
                    });
                }

                if (stepNext) {
                    stepNext.addEventListener('click', function() {
                        if (currentStep < 2) {
                            currentStep = 2;
                            updateSteps();
                        }
                    });
                }

                updateSteps();

                // Integra√ß√£o com diagrams.net (carregar template via dropdown)
                const editorFrame = overlay.querySelector('#uml-editor-iframe');
                const diagramTypeSelect = overlay.querySelector('#uml-diagram-type');
                const statusEl = overlay.querySelector('#editor-status');
                let editorReady = false;
                let pendingXml = null;

                function buildXmlFor(type) {
                    // Gera um XML .drawio m√≠nimo com 1-2 formas dependendo do tipo
                    const head = '<mxfile><diagram id="diagram-1" name="Page-1"><mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/>';
                    const tail = '</root></mxGraphModel></diagram></mxfile>';
                    let body = '';
                    switch (type) {
                        case 'classes':
                            body = '<mxCell id="2" value="Classe" style="shape=rectangle;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="100" y="100" width="140" height="60" as="geometry"/></mxCell>';
                            break;
                        case 'casos-uso':
                            body = '<mxCell id="2" value="Caso de Uso" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="120" y="120" width="160" height="80" as="geometry"/></mxCell>';
                            break;
                        case 'sequencia':
                            body = ''+
                              '<mxCell id="2" value="Ator" style="shape=rectangle;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="80" y="80" width="80" height="40" as="geometry"/></mxCell>'+
                              '<mxCell id="3" value="Objeto" style="shape=rectangle;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="240" y="80" width="100" height="40" as="geometry"/></mxCell>';
                            break;
                        case 'atividades':
                            body = '<mxCell id="2" value="Atividade" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="120" y="120" width="140" height="60" as="geometry"/></mxCell>';
                            break;
                        case 'estados':
                            body = '<mxCell id="2" value="Estado" style="shape=rectangle;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="140" y="120" width="120" height="50" as="geometry"/></mxCell>';
                            break;
                        case 'componentes':
                            body = '<mxCell id="2" value="Componente" style="shape=rectangle;whiteSpace=wrap;html=1;" vertex="1" parent="1"><mxGeometry x="140" y="120" width="140" height="60" as="geometry"/></mxCell>';
                            break;
                        default:
                            body = '';
                    }
                    return head + body + tail;
                }

                function sendXmlToEditor(xml) {
                    if (editorFrame && editorFrame.contentWindow) {
                        const msg = { action: 'load', autosave: 1, xml };
                        editorFrame.contentWindow.postMessage(JSON.stringify(msg), '*');
                    }
                }

                function onEditorMessage(evt) {
                    try {
                        const data = typeof evt.data === 'string' ? JSON.parse(evt.data) : evt.data;
                        if (data === 'ready' || (data && (data.event === 'init' || data.event === 'configure'))) {
                            editorReady = true;
                            if (pendingXml) {
                                sendXmlToEditor(pendingXml);
                                pendingXml = null;
                            }
                        }
                    } catch (_) { /* ignore */ }
                }
                window.addEventListener('message', onEditorMessage);

                if (diagramTypeSelect) {
                    diagramTypeSelect.addEventListener('change', function() {
                        const val = this.value;
                        if (!val) return;
                        const xml = buildXmlFor(val);
                        if (statusEl) statusEl.textContent = 'Carregando modelo...';
                        if (editorReady) {
                            sendXmlToEditor(xml);
                        } else {
                            pendingXml = xml;
                        }
                        setTimeout(() => { if (statusEl) statusEl.textContent = 'Modelo aplicado'; }, 600);
                        // Ir automaticamente para o passo 2 ao escolher um tipo
                        if (currentStep === 1) {
                            currentStep = 2;
                            updateSteps();
                        }
                    });
                }

                // Fechar overlay
                const closeBtn = document.getElementById('close-uml-editor-overlay');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        overlay.remove();
                        window.removeEventListener('message', onEditorMessage);
                    });
                }
            });
        }
        
        // Event listener para upload de arquivo
        const fileInput = submissionWrapper.querySelector('.file-input');
        const fileUploadArea = submissionWrapper.querySelector('.file-upload-area');
        
        if (fileInput && fileUploadArea) {
            // Click no √°rea de upload
            fileUploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            // Drag and drop
            fileUploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.backgroundColor = 'var(--muted)';
            });
            
            fileUploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.backgroundColor = '';
            });
            
            fileUploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.backgroundColor = '';
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelection(files[0]);
                }
            });
            
            // Sele√ß√£o de arquivo
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleFileSelection(e.target.files[0]);
                }
            });
            
            function handleFileSelection(file) {
                // Validar tamanho (10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert('Arquivo muito grande! Tamanho m√°ximo: 10MB');
                    return;
                }

                // Fun√ß√£o para formatar tamanho do arquivo
                function formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                }

                // Fun√ß√£o para obter √≠cone do tipo de arquivo
                function getFileTypeIcon(fileType) {
                    if (fileType.startsWith('image/')) return 'üñºÔ∏è';
                    if (fileType === 'application/pdf') return 'üìÑ';
                    if (fileType.includes('svg')) return 'üé®';
                    return 'üìÅ';
                }

                const fileName = file.name;
                const fileSize = formatFileSize(file.size);
                const fileType = file.type;
                const fileIcon = getFileTypeIcon(fileType);

                // Criar √°rea de pr√©-visualiza√ß√£o
                fileUploadArea.innerHTML = `
                    <div class="file-preview-area" style="margin-top: 0;">
                        <div class="preview-header" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; background: var(--muted); border-bottom: 1px solid var(--border);">
                            <h4 style="margin: 0; font-size: 1rem; font-weight: 600;">üìÑ Pr√©-visualiza√ß√£o do arquivo</h4>
                            <button type="button" class="button button-ghost" id="remove-file-btn" style="padding: 0.25rem 0.5rem; font-size: 0.875rem;">
                                ‚úï Remover
                            </button>
                        </div>
                        <div class="preview-content" id="file-preview-content" style="padding: 1.5rem; text-align: center; min-height: 200px; display: flex; align-items: center; justify-content: center;">
                            <!-- Conte√∫do da pr√©-visualiza√ß√£o ser√° inserido aqui -->
                        </div>
                        <div class="file-info" style="padding: 1rem 1.5rem; background: var(--muted); border-top: 1px solid var(--border); font-size: 0.875rem;">
                            <div class="file-info-item" style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span class="file-info-label" style="font-weight: 500; color: var(--muted-foreground);">Nome:</span>
                                <span class="file-info-value" style="color: var(--foreground);">${fileName}</span>
                            </div>
                            <div class="file-info-item" style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span class="file-info-label" style="font-weight: 500; color: var(--muted-foreground);">Tamanho:</span>
                                <span class="file-info-value" style="color: var(--foreground);">${fileSize}</span>
                            </div>
                            <div class="file-info-item" style="display: flex; justify-content: space-between; margin-bottom: 0;">
                                <span class="file-info-label" style="font-weight: 500; color: var(--muted-foreground);">Tipo:</span>
                                <span class="file-info-value" style="color: var(--foreground);">${fileType || 'Desconhecido'}</span>
                            </div>
                        </div>
                    </div>
                `;

                // Criar pr√©-visualiza√ß√£o baseada no tipo
                const previewContent = fileUploadArea.querySelector('#file-preview-content');
                if (fileType.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewContent.innerHTML = `
                            <img src="${e.target.result}" alt="Pr√©-visualiza√ß√£o de ${fileName}" style="max-width: 100%; max-height: 400px; border-radius: var(--radius); box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
                        `;
                    };
                    reader.readAsDataURL(file);
                } else if (fileType === 'application/pdf') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewContent.innerHTML = `
                            <iframe src="${e.target.result}#toolbar=0&navpanes=0&scrollbar=0" 
                                    title="Pr√©-visualiza√ß√£o de ${fileName}"
                                    style="width: 100%; height: 500px; border: none; border-radius: var(--radius);">
                            </iframe>
                        `;
                    };
                    reader.readAsDataURL(file);
                } else {
                    previewContent.innerHTML = `
                        <div>
                            <div class="file-type-icon" style="font-size: 3rem; margin-bottom: 1rem;">${fileIcon}</div>
                            <h4>${fileName}</h4>
                            <p>Arquivo selecionado com sucesso!</p>
                            <small>Pr√©-visualiza√ß√£o n√£o dispon√≠vel para este tipo de arquivo.</small>
                        </div>
                    `;
                }
                
                // Mostrar o bot√£o "Enviar Atividade" quando arquivo for selecionado
                const submitFooter = submissionWrapper.querySelector('.submission-footer');
                if (submitFooter) {
                    submitFooter.style.display = 'block';
                }

                // Event listener para remover arquivo
                const removeBtn = fileUploadArea.querySelector('#remove-file-btn');
                if (removeBtn) {
                    removeBtn.addEventListener('click', function() {
                        fileInput.value = '';
                        // Restaurar √°rea de upload original
                        fileUploadArea.innerHTML = `
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem; padding: 2rem; border: 2px dashed var(--border); border-radius: var(--radius); cursor: pointer; transition: all 0.3s ease; text-align: center;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" x2="8" y1="13" y2="13"/>
                                    <line x1="16" x2="8" y1="17" y2="17"/>
                                    <polyline points="10 9 9 9 8 9"/>
                                </svg>
                                <div>
                                    <h4 style="margin: 0; font-size: 1.125rem; color: var(--foreground);">üìÅ Selecione seu arquivo</h4>
                                    <p style="margin: 0; color: var(--muted-foreground);">Arraste e solte ou clique para escolher</p>
                                    <small style="color: var(--muted-foreground); font-size: 0.75rem;">Formatos aceitos: PNG, JPG, SVG, PDF (m√°x. 10MB)</small>
                                </div>
                            </div>
                        `;
                        
                        // Reconfigurar event listeners
                        const newUploadArea = fileUploadArea.querySelector('div');
                        newUploadArea.addEventListener('click', function() {
                            fileInput.click();
                        });
                        
                        // Ocultar bot√£o de envio
                        if (submitFooter) {
                            submitFooter.style.display = 'none';
                        }
                    });
                }
            }
        }
        
        // Envio da atividade (Upload)
        const submitButton = submissionWrapper.querySelector('.submission-footer button');
        if (submitButton) {
            submitButton.addEventListener('click', function(e) {
                e.preventDefault();
                const isUploadVisible = uploadMethod && !uploadMethod.classList.contains('hidden');
                const hasFile = fileInput && fileInput.files && fileInput.files.length > 0;
                if (isUploadVisible && hasFile) {
                    submissionWrapper.innerHTML = `
                        <div class="dashboard-card">
                            <div class="submission-status completed">
                                <div class="status-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    </svg>
                                </div>
                                <div class="status-content">
                                    <h3>Atividade Enviada</h3>
                                    <p>Sua atividade foi submetida com sucesso</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
        }

        const codeEditorEl = document.getElementById('code-editor');
        if (codeEditorEl) {
            var editor = ace.edit(codeEditorEl);
            editor.setTheme("ace/theme/tomorrow_night_eighties");
            editor.session.setMode("ace/mode/javascript");
            editor.setFontSize(14);
        }
    }

    // --- FUN√á√ïES DE CONTROLE DE VISIBILIDADE ---
    function showActivityDetail(activityId) {
        const activity = activityDatabase[activityId];
        if (!activity) return;

        // Preenche o conte√∫do
        activityTitleHeader.textContent = activity.title;
        instructionsWrapper.innerHTML = activity.instructions;
        submissionWrapper.innerHTML = activity.submissionContent;

        // Troca a visibilidade das telas
        exerciseListView.classList.add('hidden');
        listHeader.classList.add('hidden');
        activityDetailView.classList.remove('hidden');
        detailHeader.classList.remove('hidden');

        // Inicializa o painel de submiss√£o para qualquer atividade
        initializeSubmissionPanel();
    }

    function showExerciseList() {
        activityDetailView.classList.add('hidden');
        detailHeader.classList.add('hidden');
        exerciseListView.classList.remove('hidden');
        listHeader.classList.remove('hidden');
    }

    // --- EVENT LISTENERS GLOBAIS ---
    viewActivityBtns.forEach(btn => {
        btn.addEventListener('click', function(event) {
            event.preventDefault();
            if (this.classList.contains('locked') || this.hasAttribute('disabled') || this.getAttribute('aria-disabled') === 'true') {
                return;
            }
            const activityId = this.getAttribute('data-activity-id');
            showActivityDetail(activityId);
        });
    });

    backToExercisesBtn.addEventListener('click', function(event) {
        event.preventDefault();
        showExerciseList();
    });

    // L√ìGICA DAS ABAS (Original)
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabPanes = document.querySelectorAll('.tab-pane');
    tabLinks.forEach(link => {
        link.addEventListener('click', function () {
            if (this.querySelector('.lock-icon')) return;
            const targetId = this.getAttribute('data-tab');
            const targetPane = document.getElementById(targetId);
            
            tabLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            
            tabPanes.forEach(p => p.classList.remove('active'));
            if (targetPane) {
                targetPane.classList.add('active');
            }
        });
    });
    
    // Menu do usu√°rio √© gerenciado pelo dark-mode.js
});
</script>
<script src="/js/dark-mode.js"></script>
</body>
</html>